!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core")):"function"==typeof define&&define.amd?define(["exports","@angular/core"],t):t(e.ng2Webstorage=e.ng2Webstorage||{},e.ng.core)}(this,function(e,t){"use strict";function r(e,t){return function(r,n){var o=e||n,i=g.genKey(o);Object.defineProperty(r,n,{get:function(){return y.retrieve(t,i)},set:function(e){this[i]=e,y.store(t,i,e)}})}}function n(e){return r(e,i.local)}function o(e){return r(e,i.session)}var i;!function(e){e[e.local=0]="local",e[e.session=1]="session"}(i||(i={}));var s,a="ng2-webstorage",c="|",l=(s={},s[i.local]="local",s[i.session]="session",s),u=a,f=c,g=function(){function e(){}return e.retrieveKeysFromStorage=function(e){return Object.keys(e).filter(function(e){return 0===e.indexOf(u)})},e.genKey=function(e){if("string"!=typeof e)throw Error("attempt to generate a storage key with a non string value");return""+u+f+e.toString().toLowerCase()},e.setStorageKeyPrefix=function(e){void 0===e&&(e=a),u=e},e.setStorageKeySeparator=function(e){void 0===e&&(e=c),f=e},e}(),h=function(){function e(){}return e.observe=function(e,r){var n=this.genObserverKey(e,r);return n in this.observers?this.observers[n]:this.observers[n]=new t.EventEmitter},e.emit=function(e,t,r){var n=this.genObserverKey(e,t);n in this.observers&&this.observers[n].emit(r)},e.genObserverKey=function(e,t){return e+"|"+t},e.observers={},e}(),v=function(){function e(){}return e.isSecuredField=function(t){return!!~e.securedFields.indexOf(t)},e.getStorage=function(t){return this.mockStorages[t]||(this.mockStorages[t]=e.generateStorage()),this.mockStorages[t]},e.generateStorage=function(){var t={};return Object.defineProperties(t,{setItem:{writable:!1,enumerable:!1,configurable:!1,value:function(t,r){e.isSecuredField(t)||(this[t]=r)}},getItem:{writable:!1,enumerable:!1,configurable:!1,value:function(t){return e.isSecuredField(t)?null:this[t]||null}},removeItem:{writable:!1,enumerable:!1,configurable:!1,value:function(t){e.isSecuredField(t)||delete this[t]}},length:{enumerable:!1,configurable:!1,get:function(){return Object.keys(this).length}}}),t},e.securedFields=["setItem","getItem","removeItem","length"],e.mockStorages={},e}(),y=function(){function e(){}return e.store=function(e,t,r){this.getStorage(e).setItem(t,JSON.stringify(r)),this.cached[e][t]=r,h.emit(e,t,r)},e.retrieve=function(e,t){if(this.cached[e][t])return this.cached[e][t];var r=null;try{r=JSON.parse(this.getStorage(e).getItem(t))}catch(e){console.warn("invalid value for "+t)}return this.cached[e][t]=r},e.clearAll=function(e){var t=this,r=this.getStorage(e);g.retrieveKeysFromStorage(r).forEach(function(n){r.removeItem(n),delete t.cached[e][n],h.emit(e,n,null)})},e.clear=function(e,t){this.getStorage(e).removeItem(t),delete this.cached[e][t],h.emit(e,t,null)},e.getStorage=function(e){return this.isStorageAvailable(e)?this.getWStorage(e):v.getStorage(e)},e.getWStorage=function(e){var t;switch(e){case i.local:t=localStorage;break;case i.session:t=sessionStorage;break;default:throw Error("invalid storage type")}return t},e.isStorageAvailable=function(e){if("boolean"==typeof this.storageAvailability[e])return this.storageAvailability[e];var t=!0,r=this.getWStorage(e);if("object"==typeof r)try{r.setItem("test-storage","foobar"),r.removeItem("test-storage")}catch(e){t=!1}else t=!1;return t||console.warn(l[e]+" storage unavailable, Ng2Webstorage will use a fallback strategy instead"),this.storageAvailability[e]=t},e.cached=(t={},t[i.local]={},t[i.session]={},t),e.storageAvailability=(r={},r[i.local]=null,r[i.session]=null,r),e;var t,r}(),p=function(){function e(e){void 0===e&&(e=null),this.sType=e,this.sType=e}return e.prototype.store=function(e,t){var r=g.genKey(e);y.store(this.sType,r,t)},e.prototype.retrieve=function(e){var t=g.genKey(e);return y.retrieve(this.sType,t)},e.prototype.clear=function(e){e?y.clear(this.sType,g.genKey(e)):y.clearAll(this.sType)},e.prototype.observe=function(e){var t=g.genKey(e);return h.observe(this.sType,t)},e}(),b=function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},d=function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},S=function(e){function r(){e.call(this,i.local)}return b(r,e),r=d([t.Injectable()],r)}(p),m=function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},O=function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},j=function(e){function r(){e.call(this,i.session)}return m(r,e),r=O([t.Injectable()],r)}(p),w=function(e,t,r,n){var o,i=arguments.length,s=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(i<3?o(s):i>3?o(t,r,s):o(t,r))||s);return i>3&&s&&Object.defineProperty(t,r,s),s},I=function(){function e(){}return e=w([t.NgModule({declarations:[],providers:[j,S],imports:[]})],e)}();e.Ng2Webstorage=I,e.KeyStorageHelper=g,e.LocalStorage=n,e.SessionStorage=o,e.WebStorage=r,e.WebStorageService=p,e.LocalStorageService=S,e.SessionStorageService=j,Object.defineProperty(e,"__esModule",{value:!0})});